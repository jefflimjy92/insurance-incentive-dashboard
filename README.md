# 💰 VIBE 인센티브 인텔리전스 대시보드 (더바다인슈)

> **"데이터는 현대의 원유와 같지만, 올바른 로직을 통해 정제될 때 비로소 진정한 가치를 발휘합니다."**  
> VIBE는 **더바다인슈**의 복잡한 보험 시상 규정을 완벽하게 분석하고, 이를 직관적인 시각적 통계와 고정밀 지급 데이터로 전환하는 최첨단 인센티브 자동화 및 성과 분석 플랫폼입니다.

---

## 🏛 기술 아키텍처 및 시스템 개요

VIBE는 디스플레이 레이어(UI)와 계산 알고리즘(Logic)이 철저히 분리된 **"엔진 중심(Engine-First)"** 설계로 구축되어, 데이터 처리의 안정성과 확장성을 동시에 보장합니다.

### 1. 🧠 고정밀 인센티브 엔진 (`incentive_engine.py`)
보험대리점(GA)의 복잡한 시상 규정을 실시간으로 처리하는 핵심 알고리즘입니다.

*   **연속형 시상 (Multi-Period Analysis)**:
    *   **시계열 달성 추적**: 3개월, 13개월 등 연속적인 성과를 분석하여 지급 자격을 검증합니다.
    *   **역추적(Backtracking) 로직**: 과거 달성 이력을 자동으로 탐색하여 현재 시점의 최종 보상액을 산출합니다.
    *   **연도/월 보정 시스템**: 연말 연초 날짜 겹침 현상이나 13차월 시상 등을 정확히 처리하기 위한 특수 날짜 보정 로직이 탑재되어 있습니다.
*   **계단형/정률형 시상 (Tiered & Fixed Rate)**:
    *   무제한 단계의 보상 구간을 지원하며, 다음 구간 달성까지 부족한 실적(Gap)과 기대 보상액을 실시간으로 계산합니다.
*   **헝거게임(Hunger Games) 분쟁 해결 로직**:
    *   동일 실적에 대해 여러 시상(예: 원수사 시상 vs 지점 시상)이 중복될 경우, **설계사에게 가장 유리한(최대 금액) 시나리오를 자동으로 선택**합니다.
    *   중복 수혜 배제 원칙을 준수하면서도 설계사의 이익을 극대화합니다.

### 2. 🛡️ 강력한 데이터 정제 및 표준화 (`data_loader.py`)
VIBE는 불완전한 원시 데이터를 신뢰할 수 있는 정보로 변환하는 다단계 정제 파이프라인을 운영합니다.

*   **표준화 레이어(Standardization)**:
    *   **보험사 명칭 통합**: "KB손보", "KB손해", "KB" 등 산재한 명칭을 하나의 "KB손해보험" 객체로 자동 매핑합니다.
    *   **정규표현식 날짜 파싱**: `YYYYMMDD`, `YYYY-MM-DD`, `YY/MM/DD` 등 다양한 날짜 형식을 지능적으로 인식합니다.
*   **데이터 정화 파이프라인 (The Purge)**:
    *   **본인계약 자동 필터링**: 컴플라이언스 준수를 위해 사원명과 계약자명이 동일한 계약을 자동으로 감지하여 계산에서 제외합니다.
    *   **중복 제거(De-duplication)**: 로우(Row) 단위의 해싱을 통해 동일 계약이 중복 집계되는 것을 원천 차단합니다.
*   **지능형 상품 분류 및 판별 로직 (Product Classification)**:
    단순한 텍스트 매칭을 넘어, 키워드/상품종류/계약종류의 조합을 통해 실적 기여도를 정확히 판별합니다.

    | 분류 순위 | 상품군 | 판별 조건 및 방법 |
    | :--- | :--- | :--- |
    | **1순위** | **펫보험** | 상품명에 **'펫'** 키워드가 포함된 경우 최우선 분류 |
    | **2순위** | **실손/운전자** | 상품명에 **'실손'**, **'운전자'** 키워드가 포함된 경우 (**인보험**으로 분류) |
    | **3순위** | **단체보험** | (상품종류='보장성' & 계약종류='장기' & 상품명에 **'단체'** 포함) OR (상품종류=**'단체'**) |
    | **4순위** | **자동차보험** | 계약종류=**'자동차'**인 경우만 분류 (**운전자보험 제외**) |
    | **5순위** | **재물보험** | 상품종류가 **'재물성'**인 경우 (펫/자동차 제외) |
    | **6순위** | **인보험** | 상품종류=**'보장성'** & 계약종류=**'장기'** (실손/펫/단체/자동차 제외 나머지) |
    | **7순위** | **기타** | 위 모든 조건에 해당하지 않는 나머지 계약 |

### 3. 📈 전략적 성과 분석 시스템 (`analysis.py`)
단순한 집계를 넘어 "다음에 무엇을 해야 하는가?"에 대한 답을 제시합니다.

*   **미달성 기회 분석 (ROI Focus)**:
    *   달성률 80~99% 구간의 시상을 집중 탐색합니다.
    *   **ROI(투자 대비 효과) 산출**: (추가 보상액 / 부족 실적) × 100을 통해 가성비가장 높은 '집중 공략' 대상을 추천합니다.
*   **교차 보험사 최적화 (Cross-Carrier Optimization)**:
    *   **포화 상태 감지**: 특정 보험사의 최고 단계 시상을 이미 달성한 경우를 포착합니다.
    *   **Carrier-Shift 제안**: 초과 실적을 다른 보험사의 신규 시상 달성에 투입하여 총 수령액을 높이는 전략적 전환 시점을 제안합니다.

---

## 💎 프리미엄 UI/UX 표준

### **현대적 디자인 미학**
*   **Pretendard 타이포그래피**: 한국어 가독성에 최적화된 서체와 현대적인 레이아웃.
*   **글래스모피즘(Glassmorphism)**: `backdrop-filter: blur(12px)`를 적용한 반투명 고정 헤더와 세련된 그림자 효과.
*   **동적 상태 카드**: 보상 현황을 직관적인 배지로 시각화합니다:
    *   🎉 **달성 완료**: 녹색 (지급 확정)
    *   ⚠️ **달성 임박**: 황색 (추가 실적 필요)
    *   🕒 **진행 중**: 회색 (초기 단계)

### **잔상 방지(Zero-Ghosting) 설계**
Streamlit 앱에서 흔히 발생하는 화면 전환 잔상 문제를 다음과 같이 해결했습니다:
*   **고유 컨테이너 키(Key)**: 메인 화면과 상세 화면을 DOM 레벨에서 분리하여 데이터 섞임을 방지합니다.
*   **엄격한 가시성 제어**: CSS 마커를 통해 비활성 컴포넌트를 강제 숨김 처리하여 매끄러운 내비게이션 환경을 제공합니다.

### **계층적 드릴다운(Drill-Down)**
1.  **대시보드 개요**: 전사적 통계 및 보험사별 성과 추이.
2.  **지점(팀) 현황**: 선택한 지점 소속 설계사들의 성과 비교.
3.  **설계사 상세(Ledger)**: 개별 시상 명세와 함께 **계산 근거 데이터(Evidence)**를 1:1로 매칭하여 신뢰도를 보장합니다.

---

## 🛠 배포 및 통합 가이드

### **데이터 소스 연결**
VIBE는 기존 업무 환경에 자연스럽게 녹아듭니다:
1.  **Google Sheets (실시간 동기화)**: 공용/전용 URL을 통해 실시간 협업 데이터 연동.
2.  **로컬 CSV 업로드**: 오프라인 분석 및 보안 데이터 처리를 위한 파일 업로드 지원.

### **설치 및 실행**
1.  **시상 규칙 등록**: '시상규칙' 시트에 보험사별 목표와 보상액을 입력합니다.
2.  **계약 데이터 업데이트**: CRM에서 추출한 데이터를 '계약데이터' 시트에 복사합니다.
3.  **VIBE 실행**:
    ```bash
    pip install -r requirements.txt
    streamlit run streamlit_app.py
    ```

---

## 🚀 고급 기능 및 커스텀 설정
*   **KST 서버 동기화**: 모든 날짜 계산과 연동 타임스탬프는 한국 표준시(UTC+9)로 고정되어 서버 위치에 관계없이 정확합니다.
*   **유연한 컬럼 매핑**: "모집인명", "설계사" 등 컬럼명이 미세하게 달라도 시스템이 지능적으로 인식하여 매핑합니다.

---
**더바다 (The Bada Insur)** - 독자적 인센티브 인텔리전스 시스템 v1.2
